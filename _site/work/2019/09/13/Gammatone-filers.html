<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Todd</title>
	<link rel="icon" href="/assets/images/id_photo.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="/assets/js/jquery.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <!--[if IE 7]>
    <link rel="stylesheet" href="assets/css/font-awesome-ie7.min.css">
    <![endif]-->
    <!--[if lt IE 9]>
       <script src="https://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
       <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.js"></script>
    <![endif]-->
    <link href="/assets/css/main.css" rel="stylesheet" type="text/css">


</head>

<body>

<div class="container-fluid">
    <div class="row-fluid">
        <div class="navbar navbar-custom navbar-fixed-top" role="navigation">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav ">
                    
                    <li class="active"><a class="navbar-brand" href="/">Todd</a></li>
                    <li class="active"><a href="/">Home</a></li>
                    <li class="active"><a href="/archive.html">Archive</a></li>
                    <li class="active"><a href="/categories.html">Categories</a></li>
                    <li class="active"><a href="/tags.html">Tags</a></li>
                    <li class="active"><a href="/about.html">About</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

<div class="wrap">
    <div class="container-fluid  container-left">
        <div class="row">
            <div class="col-md-2 hidden-xs">
                
<div class="sidebar well">
    <header class="sidebar-header" role="banner">
        <a href="/">
            <img src="/assets/images/id_photo.png" class="img-circle" width="80px"/>
        </a>
        <!--
        <h3 class="title">
        <a href="/"></a>
        </h3>
        -->
    </header>
    <div class="text-center">
        Welcome to My blogÔºÅ
    </div>
</div>


<div class="sidebar well">
    <h1>Top Posts</h1>
    <ul>
        
            
                
            
                
            
        
    </ul>
</div>


<div class="sidebar well">
    <h1>Recent Posts</h1>
    <ul>
        
          <li><a href="/work/2019/09/13/change-python-version.html">Change python version</a></li>
        
          <li><a href="/work/2019/09/13/Gammatone-filers.html">Gammatone-filter</a></li>
        
    </ul>
</div>

<div class="sidebar well">
    
<h1>Links</h1>
<ul>
  <!-- <li><a href="#">One</a></li>
  <li><a href="#">Two</a></li>
  <li><a href="#">Three</a></li>
  <li><a href="#">Four</a></li> -->
  
  <li>
    <a href="https://github.com/bingo-todd">
      Github
    </a>
  </li> 
  
  <li>
    <a href="https://bingo-todd.github.io">
      Github pages
    </a>
  </li> 
  
  <li>
    <a href="https://github.com/zxixia/jekyll-xixia">
      Referent theme
    </a>
  </li> 
  
</ul>

</div>

            </div>
            <div class="col-md-1">
            </div>
            <div class="col-md-8">
                
<div class="well article">
        <h2><a href="/work/2019/09/13/Gammatone-filers.html">Gammatone-filter</a></h2>
        <span class="post-date">
            
            September-13-2019
        </span>
        <hr style="border-top:1px solid #28323C;"/>
    
    <div class="post-content">
    <h1 id="gammatone-filters">Gammatone-filters</h1>
<p>Python implementation of Gammatone filter.</p>

<p>The filtering part of code is written in C.</p>

<h2 id="basic-ideas-">Basic ideas <sup id="fnref:Holdsworth1988"><a href="#fn:Holdsworth1988" class="footnote">1</a></sup></h2>
<p>The impulse response of Gammatone filter is defined as follow</p>

<script type="math/tex; mode=display">g(t) = \frac{at^{n-1}\cos(2\pi f_ct+\phi)}{e^{2\pi b t}}</script>

<p>in which</p>

<ul>
  <li><script type="math/tex">f_c</script>: center frequency</li>
  <li><script type="math/tex">b</script> : bandwidth,</li>
</ul>

<p><script type="math/tex">g(t)</script> can be regarded as the mutliplication result of two parts,</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{equation}
\begin{aligned}
g(t)&=a \times \underbrace{t^{n-1}e^{-2\pi bt}}_\text{r(t)} \times \underbrace{cos(2\pi f_c t+\phi)}_{s(t)}\\
\end{aligned}
\end{equation} %]]></script>

<p>Multiplication in time domain = convolution in frequency domain, so</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{equation}
\begin{aligned}
R(f)=FT(t^{n-1}e^{-2\pi b t})
&=\frac{1}{(j2\pi)^{n-1}}\frac{\partial^{n-1} FT(e^{-2\pi bt})}{\partial f^{n-1}}\\
&=\frac{1}{(j2\pi)^{n-1}}\frac{\partial^{n-1}\frac{1}{2\pi b+j2\pi f}}{\partial f^{n-1}}\\
&=\frac{1}{(j2\pi)^{n-1}}\frac{(j)^{n-1}(n-1)!}{2\pi}\frac{1}{(b+jf)^n}\\
&=\frac{(n-1)!}{(2\pi b)^n}\frac{1}{(1+jf/b)^n} \label{eq:1}
\end{aligned}
\end{equation} %]]></script>

<script type="math/tex; mode=display">% <![CDATA[
\begin{equation}
\begin{aligned}
S(f)=FT\left(cos(2\pi f_ct+\phi)\right)
&=e^{j\phi}\delta(f-f_c)+e^{-j\phi}\delta(f+f_c)
\end{aligned}
\end{equation} %]]></script>

<p>Combine equation (2) and (3), we can get <script type="math/tex">G(f)</script></p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{equation}
\begin{aligned}
G(f)&=a \times R(f)*S(f)\\
&=a \times e^{j\phi}\frac{(n-1)!}{(2\pi b)^n}\frac{1}{(1+j(f-f_c)/b)^n}+ae^{-j\phi}\frac{(n-1)!}{(2\pi b)^n}\frac{1}{(1+j(f+f_c)/b)^n}\\
&=a\frac{(n-1)!}{(2\pi b)^n}\left[e^{j\phi}\left(\frac{1}{(1+j(f-f_c)/b)}\right)^n+e^{-j\phi}\left(\frac{1}{(1+j(f+f_c)/b)}\right)^n\right]
\end{aligned}
\end{equation} %]]></script>

<p>As shown in the following diagram,<script type="math/tex">G(f)</script> consists of two symmetric parts. For simplicity, only positive frequency side is considered</p>

<p><img src="/assets/images/Gammatone-filters/gtf-ir-spectrum.png" width="60%" /></p>

<p>Further more, Gammatone filter can be regarded as low-pass filter with frequency shitfted by fc. Now, equalently, we can first shift input signal by -fc and filter it with a lowpass filter, finally shift the frequency by fc.</p>

<p><img src="/assets/images/Gammatone-filters/diagram.png" alt="diagram" /></p>

<p>The detailed derivation is in <a href="README.pdf">README.pdf</a></p>

<h2 id="usage">Usage</h2>

<pre><code class="language-Python">  from GTF import GTF
  gt_filter = GTF(fs=44100,low_cf=80,high_cf=5000,N_band=32)
  x_filtered = gt_filter.filter_c(x,is_aligned=0)# not aligned
</code></pre>

<h2 id="buildin-examples">Buildin examples</h2>

<p>In termial</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  python GTF.py example
</code></pre></div></div>
<pre><code class="language-Python">  #definition of example func
  def example():
      fs = 16e3
      gt_filter = GTF(fs,freq_low=80,freq_high=5e3,N_band=16)

      # delays and gains
      fig = plt.figure()
      gt_filter.cal_delay_gain_cfs(is_plot=True,fig=fig)
      fig.savefig('/assets/images/Gammatone-filters/delay_gain.png')

      # impulse response direct from equation
      ir_equation = gt_filter.get_ir_equation()
      ir_equation = ir_equation/np.max(np.abs(ir_equation))

      # ir: filter impulse signal
      ir = gt_filter.get_ir(is_gain_norm=False,is_aligned=False)
      ir = ir/np.max(np.abs(ir))

      #
      ir_norm = gt_filter.get_ir(is_gain_norm=True,is_aligned=False)

      # ir phase compensated
      ir_norm_aligned = gt_filter.get_ir(is_gain_norm=True,is_aligned=True,delay_common=0)

      # plot ir
      if not os.path.exists('/assets/images/Gammatone-filters'):
          os.mkdir('/assets/images/Gammatone-filters')

      fig_ir_eq = gt_filter.plot_ir_spec(ir_equation)
      fig_ir_eq.savefig('/assets/images/Gammatone-filters/ir_equation.png')

      fig_ir = gt_filter.plot_ir_spec(ir)
      fig_ir.savefig('/assets/images/Gammatone-filters/ir.png')

      fig_norm = gt_filter.plot_ir_spec(ir_norm)
      fig_norm.savefig('/assets/images/Gammatone-filters/ir_norm.png')

      fig_ir_norm_aligned = gt_filter.plot_ir_spec(ir_norm_aligned)
      fig_ir_norm_aligned.savefig('/assets/images/Gammatone-filters/ir_norm_aligned.png')

      gt_filter.filter_spectrum()
</code></pre>
<ul>
  <li>
    <p>Spectrum of Gammatone filter</p>

    <p>Only filter with cf=4kHz is ploted</p>

    <p><img src="/assets/images/Gammatone-filters/filter_spectrum.png" alt="delays_gains" /></p>
  </li>
  <li>
    <p>Delays and gains at cfs</p>

    <p><img src="/assets/images/Gammatone-filters/delay_gain.png" alt="delay_gain.png" /></p>

    <p>Basically, the phase delay at center frequency approximates 0.</p>
  </li>
  <li>
    <p>Impulse response of Gammatone filters</p>

    <ul>
      <li>
        <p>Max-amplitude normalized</p>

        <p><img src="/assets/images/Gammatone-filters/ir.png" alt="ir.png" /></p>
      </li>
      <li>
        <p>Gain normalization</p>

        <p><img src="/assets/images/Gammatone-filters/ir_norm.png" alt="ir_norm" /></p>
      </li>
      <li>
        <p>Phase compensation</p>

        <p>Phase compensation is actually to align impulse response peaks of all filter<sup id="fnref:Brown1994"><a href="#fn:Brown1994" class="footnote">2</a></sup>.</p>

        <p><img src="/assets/images/Gammatone-filters/ir_norm_aligned.png" alt="ir_norm_aligned" /></p>

        <!-- Next, I want to make summary about signal recovery after filtered by Gammatone filters.[Flag] -->
      </li>
    </ul>
  </li>
</ul>

<h2 id="about-efficiency">About efficiency</h2>

<p>The key filter part is both written in c and python, and apparentlly, the c implementation is much fast</p>

<p>Efficiency test</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$$</span> python GTF.py efficiency

   <span class="nb">time </span>consumed<span class="o">(</span>s<span class="o">)</span>
      c         :0.39
      python    :36.23
</code></pre></div></div>

<div class="footnotes">
  <ol>
    <li id="fn:Holdsworth1988">
      <p>Holdsworth, John, Roy Patterson, and Ian Nimmo-Smith. Implementing a GammaTone Filter Bank¬†<a href="#fnref:Holdsworth1988" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:Brown1994">
      <p>G. J. Brown and M. P. Cooke (1994) Computational auditory scene analysis. Computer Speech and Language, 8, pp. 297-336¬†<a href="#fnref:Brown1994" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

    <hr style="border-top:1px solid #28323C;"/>

    <!-- tags and categories under post -->
    
    <ul class="list-unstyled list-inline">
      <li><i class="icon-folder-open"></i></li>
      
      
         
            <li class="icon-style"><a href="/categories.html">
                Work <span>(2)</span>
                
            </a></li>
        
      
    </ul>
      

    
    <ul class="list-unstyled list-inline">
      <li><i class="icon-tags"></i></li>
      
      
         
            <li class="icon-style">
                <a href="/tags.html">
                github <span>(1)</span>
                
                </a>
            </li>
        
      
      
    </ul>
      

    </div>
    
</div>
<div class="pagination">
    
    <a class="btn btn-default" href="/work/2019/09/13/change-python-version.html" class="next">Newer Post</a>
    
    
</div>
            </div>
            <div class="col-md-1">
            </div>
        </div>
    </div>

    
<div class="footer">
    <p>&copy;2019 Todd , Powered by
            
                <a href="http://jekyllrb.com/">
                Jekyll
                </a>
                <!-- not the last, output a ',' -->
                
                ,
                
            
                <a href="http://getbootstrap.com/">
                Bootstrap
                </a>
                <!-- not the last, output a ',' -->
                
                ,
                
            
                <a href="https://github.com/">
                Github
                </a>
                <!-- not the last, output a ',' -->
                
                ,
                
            
                <a href="https://github.com/zxixia/jekyll-xixia">
                Xixia
                </a>
                <!-- not the last, output a ',' -->
                
            
    </p>
</div>

<!-- 
    

    
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', '', 'auto');
    ga('send', 'pageview');
  </script>

 
-->

</body>
</html>

</div>
